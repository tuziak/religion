function draw_map(){mapboxgl.accessToken="pk.eyJ1IjoidHV6aWFrIiwiYSI6ImNsaGlybHdpbTBiMmgzcW51cDRvZHoyMWQifQ.zngFQXHvnbk1jKeGo4_Oeg";var e=[],o=document.getElementsByClassName("map_message")[0];fetch("https://raw.githubusercontent.com/tuziak/religion/main/all_property.geojson").then((e=>e.json())).then((o=>{e=o,function(){console.log(e);var o=document.querySelector("#table_religion > tbody");e.features.forEach(((e,t)=>{o.appendChild(document.createElement("tr")).innerHTML="<td>"+e.properties.type+"</td><td>"+e.properties.address+"</td><td>"+e.properties.use+"</td><td>"+e.properties.area+"</td><td>"+e.properties.own+"</td>"})),$("#table_religion").DataTable({lengthMenu:[20],language:{thousands:"",info:"Записів: _TOTAL_",infoEmpty:"",infoFiltered:"",lengthMenu:"",paginate:{first:"",last:"",next:"",previous:""},search:"",searchPlaceholder:"Пошук нерухомості",zeroRecords:"Нічого не знайдено. Спробуйте інший запит"}})}()})).catch((e=>console.log(e)));var t=new mapboxgl.Map({container:"map_religion",style:"mapbox://styles/tuziak/clhq0r2p801uh01qy2d6cc3rb",center:[31.16,48.38],zoom:5,maxBounds:[17.687988,42.90816,49.328613,54.316523]});t.on("load",(()=>{t.resize(),t.addSource("religion_all",{type:"geojson",data:e}),t.addSource("lands_min",{type:"geojson",data:"https://raw.githubusercontent.com/tuziak/religion/main/lands_min.geojson"}),t.addLayer({id:"religion_houses",type:"circle",source:"religion_all",paint:{"circle-color":"tomato","circle-opacity":.8,"circle-radius":{base:2,stops:[[7,3],[9,10]]}},filter:["all",["==","type","будівля"],["==","q","+"]]}),t.addLayer({id:"lands_min",type:"fill",source:"lands_min",paint:{"fill-color":"black","fill-opacity":.8,"fill-outline-color":"white"}}),t.addLayer({id:"religion_lands",type:"circle",source:"religion_all",paint:{"circle-color":"#FF3131","circle-opacity":.9,"circle-radius":{base:2,stops:[[7,3],[9,10]]}},filter:["==","type","земельна ділянка"]});t.addControl(new MapboxGeocoder({accessToken:mapboxgl.accessToken,mapboxgl:mapboxgl,marker:{color:"#7B7B8E"},countries:"ua",limit:7}).on("result",(o=>{for(const t of e.features)t.properties.distance=turf.distance(o.result.geometry,t.geometry.coordinates);e.features.sort(((e,o)=>e.properties.distance>o.properties.distance?1:e.properties.distance<o.properties.distance?-1:0))})));const o=new mapboxgl.Popup({closeButton:!1,closeOnClick:!1});t.on("mouseenter",["religion_houses","religion_lands"],(e=>{t.getCanvas().style.cursor="pointer";const r=e.features[0].geometry.coordinates.slice(),n=e.features[0].properties.desc;for(;Math.abs(e.lngLat.lng-r[0])>180;)r[0]+=e.lngLat.lng>r[0]?360:-360;o.setLngLat(r).setHTML(n).addTo(t)})),t.on("mouseleave",["religion_houses","religion_lands"],(()=>{t.getCanvas().style.cursor="",o.remove()}))})),t.on("idle",(()=>{o.innerHTML="<div>Ви бачите <strong>"+t.queryRenderedFeatures({layers:["religion_houses"]}).length+"</strong> будівель та <strong>"+t.queryRenderedFeatures({layers:["religion_lands"]}).length+"</strong> земельних ділянок УПЦ МП</div>",""!=document.getElementsByClassName("mapboxgl-ctrl-geocoder--input")[0].value&&(o.innerHTML+='<p>Найближча власність УПЦ МП розташована за <strong><span style="background-color:#FFF200";>'+e.features.filter((e=>"+"==e.properties.q))[0].properties.distance.toFixed()+" км</strong></span> за адресою "+e.features.filter((e=>"+"==e.properties.q))[0].properties.address+"</p>")}))}document.addEventListener("DOMContentLoaded",(function(){draw_map()}));