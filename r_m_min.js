var map_token="pk.eyJ1IjoidHV6aWFrIiwiYSI6ImNsaGlybHdpbTBiMmgzcW51cDRvZHoyMWQifQ.zngFQXHvnbk1jKeGo4_Oeg",religion_property=[],map_message=document.getElementsByClassName("map_message")[0];function draw_map(){fetch("https://cdn.rawgit.com/tuziak/religion/main/religion_propertyl.geojson").then((e=>e.json())).then((e=>{religion_property=e,function(){console.log(religion_property);var e=document.querySelector("#table_religion > tbody:nth-child(2)");religion_property.features.forEach(((r,o)=>{e.appendChild(document.createElement("tr")).innerHTML="<td>"+r.properties.type+"</td><td>"+r.properties.address+"</td><td>"+r.properties.use+"</td><td>"+r.properties.area+"</td><td>"+r.properties.own+"</td>"})),$("#table_religion").DataTable({lengthMenu:[20],language:{thousands:"",info:"Записів: _TOTAL_",infoEmpty:"",infoFiltered:"",lengthMenu:"",paginate:{first:"",last:"",next:"",previous:""},search:"",searchPlaceholder:"Пошук нерухомості",zeroRecords:"Нічого не знайдено. Спробуйте інший запит"}})}()})).catch((e=>console.log(e)));var e=new mapboxgl.Map({container:"map_religion",style:"mapbox://styles/tuziak/clhq0r2p801uh01qy2d6cc3rb",center:[31.16,48.38],zoom:5,maxBounds:[17.687988,42.90816,49.328613,54.316523]});e.on("load",(()=>{e.resize(),e.addSource("religion_all",{type:"geojson",data:religion_property}),e.addSource("lands_min",{type:"geojson",data:"https://cdn.rawgit.com/tuziak/religion/main/lands_min.geojson"}),e.addLayer({id:"religion_houses",type:"circle",source:"religion_all",paint:{"circle-color":"tomato","circle-opacity":.8,"circle-radius":{base:2,stops:[[7,3],[9,10]]}},filter:["all",["==","type","будівля"],["==","q","+"]]}),e.addLayer({id:"lands_min",type:"fill",source:"lands_min",paint:{"fill-color":"black","fill-opacity":.8,"fill-outline-color":"white"}}),e.addLayer({id:"religion_lands",type:"circle",source:"religion_all",paint:{"circle-color":"#FF3131","circle-opacity":.9,"circle-radius":{base:2,stops:[[7,3],[9,10]]}},filter:["==","type","земельна ділянка"]});e.addControl(new MapboxGeocoder({accessToken:map_token,mapboxgl:mapboxgl,marker:{color:"#7B7B8E"},countries:"ua",limit:7}).on("result",(e=>{for(const r of religion_property.features)r.properties.distance=turf.distance(e.result.geometry,r.geometry.coordinates);religion_property.features.sort(((e,r)=>e.properties.distance>r.properties.distance?1:e.properties.distance<r.properties.distance?-1:0))})));const r=new mapboxgl.Popup({closeButton:!1,closeOnClick:!1});e.on("mouseenter",["religion_houses","religion_lands"],(o=>{e.getCanvas().style.cursor="pointer";const t=o.features[0].geometry.coordinates.slice(),i=o.features[0].properties.desc;for(;Math.abs(o.lngLat.lng-t[0])>180;)t[0]+=o.lngLat.lng>t[0]?360:-360;r.setLngLat(t).setHTML(i).addTo(e)})),e.on("mouseleave",["religion_houses","religion_lands"],(()=>{e.getCanvas().style.cursor="",r.remove()}))})),e.on("idle",(()=>{map_message.innerHTML="<div>Ви бачите <strong>"+e.queryRenderedFeatures({layers:["religion_houses"]}).length+"</strong> будівель та <strong>"+e.queryRenderedFeatures({layers:["religion_lands"]}).length+"</strong> земельних ділянок УПЦ МП</div>",""!=document.getElementsByClassName("mapboxgl-ctrl-geocoder--input")[0].value&&(map_message.innerHTML+='<p>Найближча власність УПЦ МП розташована за <strong><span style="background-color:#FFF200";>'+religion_property.features.filter((e=>"+"==e.properties.q))[0].properties.distance.toFixed()+" км</strong></span> за адресою "+religion_property.features.filter((e=>"+"==e.properties.q))[0].properties.address+"</p>")}))}document.addEventListener("DOMContentLoaded",(function(){draw_map()}));