var religion_property=[];function make_chart(){fetch("https://raw.githubusercontent.com/tuziak/religion/main/all_property.geojson").then((e=>e.json())).then((e=>{religion_property=e,crt_table(),draw_map()})).catch((e=>console.log(e)))}function draw_map(){mapboxgl.accessToken="pk.eyJ1IjoidHV6aWFrIiwiYSI6ImNsaGlybHdpbTBiMmgzcW51cDRvZHoyMWQifQ.zngFQXHvnbk1jKeGo4_Oeg";var e=document.getElementsByClassName("map_message")[0],r=new mapboxgl.Map({container:"map_religion",style:"mapbox://styles/tuziak/clhq0r2p801uh01qy2d6cc3rb",center:[31.16,48.38],zoom:5,maxBounds:[17.687988,42.90816,49.328613,54.316523]});r.on("load",(()=>{r.resize(),r.addSource("religion_all",{type:"geojson",data:religion_property}),r.addSource("lands_min",{type:"geojson",data:"https://raw.githubusercontent.com/tuziak/religion/main/lands_min.geojson"}),r.addLayer({id:"religion_houses",type:"circle",source:"religion_all",paint:{"circle-color":"tomato","circle-opacity":.8,"circle-radius":{base:2,stops:[[7,3],[9,10]]}},filter:["all",["==","type","будівля"],["==","q","+"]]}),r.addLayer({id:"lands_min",type:"fill",source:"lands_min",paint:{"fill-color":"black","fill-opacity":.8,"fill-outline-color":"white"}}),r.addLayer({id:"religion_lands",type:"circle",source:"religion_all",paint:{"circle-color":"#FF3131","circle-opacity":.9,"circle-radius":{base:2,stops:[[7,3],[9,10]]}},filter:["==","type","земельна ділянка"]});r.addControl(new MapboxGeocoder({accessToken:mapboxgl.accessToken,mapboxgl:mapboxgl,marker:{color:"#7B7B8E"},countries:"ua",limit:7,placeholder:"Пошук"}).on("result",(e=>{for(const r of religion_property.features)r.properties.distance=turf.distance(e.result.geometry,r.geometry.coordinates);religion_property.features.sort(((e,r)=>e.properties.distance>r.properties.distance?1:e.properties.distance<r.properties.distance?-1:0))})));const e=new mapboxgl.Popup({closeButton:!1,closeOnClick:!1});r.on("mouseenter",["religion_houses","religion_lands"],(o=>{r.getCanvas().style.cursor="pointer";const t=o.features[0].geometry.coordinates.slice(),n=o.features[0].properties.desc;for(;Math.abs(o.lngLat.lng-t[0])>180;)t[0]+=o.lngLat.lng>t[0]?360:-360;e.setLngLat(t).setHTML(n).addTo(r)})),r.on("mouseleave",["religion_houses","religion_lands"],(()=>{r.getCanvas().style.cursor="",e.remove()}))})),r.on("idle",(()=>{e.innerHTML="<div>Ви бачите <strong>"+r.queryRenderedFeatures({layers:["religion_houses"]}).length+"</strong> будівель та <strong>"+r.queryRenderedFeatures({layers:["religion_lands"]}).length+"</strong> земельних ділянок УПЦ МП</div>",""!=document.getElementsByClassName("mapboxgl-ctrl-geocoder--input")[0].value&&(e.innerHTML+='<p>Найближча власність УПЦ МП розташована за <strong><span style="background-color:#FFF200";>'+religion_property.features.filter((e=>"+"==e.properties.q))[0].properties.distance.toFixed()+" км</strong></span> за адресою "+religion_property.features.filter((e=>"+"==e.properties.q))[0].properties.address+"</p>")}))}function crt_table(){console.log(religion_property);var e=document.querySelector("#table_religion").appendChild(document.createElement("tbody"));religion_property.features.forEach(((r,o)=>{e.appendChild(document.createElement("tr")).innerHTML="<td>"+r.properties.type+"</td><td>"+r.properties.address+"</td><td>"+r.properties.use+"</td><td>"+r.properties.area+"</td><td>"+r.properties.own+"</td>"})),$("#table_religion").DataTable({lengthMenu:[10],language:{thousands:"",info:"Записів: _TOTAL_",infoEmpty:"",infoFiltered:"",lengthMenu:"",paginate:{first:"",last:"",next:"",previous:""},search:"",searchPlaceholder:"Пошук нерухомості",zeroRecords:"Нічого не знайдено. Спробуйте інший запит"}})}document.addEventListener("DOMContentLoaded",(function(){make_chart()}));